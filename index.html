<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>editIQ ‚Äì Responsive Wireframe</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: #1a1a1a;
      color: #f0f0f0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      height: 60px;
      background: #2d2d2d;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      border-bottom: 1px solid #444;
      flex-shrink: 0;
    }

    header h1 {
      font-size: 18px;
      color: #ffffff;
    }

    .theme-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .theme-controls button,
    .theme-controls select {
      background: #444;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .toolbar {
      background: #222;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      padding: 10px 16px;
      gap: 10px;
      border-bottom: 1px solid #333;
      flex-shrink: 0;
    }

    .toolbar button {
      background: #333;
      border: 1px solid #555;
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .main-area {
      flex: 1;
      display: flex;
      flex-direction: row;
      overflow: hidden;
    }

    .canvas-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      min-height: 300px;
    }

    #canvas {
      width: 90%;
      max-width: 1000px;
      height: 80%;
      max-height: 600px;
      background: #1f1f1f;
      border: 2px dashed #555;
      position: relative;
    }

    .sidebar {
      width: 250px;
      background: #2a2a2a;
      padding: 16px;
      border-left: 1px solid #444;
      flex-shrink: 0;
    }

    .sidebar h3 {
      margin-top: 0;
      font-size: 16px;
      color: #ccc;
    }

    .sidebar p {
      font-size: 13px;
      color: #999;
    }

    .export-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #2c2c2c;
      padding: 20px;
      border: 1px solid #555;
      border-radius: 6px;
      z-index: 1000;
      display: none;
    }

    .export-popup h3 {
      margin-top: 0;
    }

    .export-popup button {
      margin-right: 10px;
      margin-top: 10px;
      padding: 6px 12px;
      background: #444;
      border: 1px solid #666;
      color: white;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .main-area {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        border-left: none;
        border-top: 1px solid #444;
      }

      #canvas {
        width: 95%;
        height: 300px;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1>editIQ ‚Äì Wireframe</h1>
    <div class="theme-controls">
      <button>üåó Toggle Mode</button>
      <select>
        <option>Theme 1</option>
        <option>Theme 2</option>
        <option>Theme 3</option>
        <option>Theme 4</option>
        <option>Theme 5</option>
        <option>Theme 6</option>
      </select>
    </div>
  </header>

  <div class="toolbar">
    <button id="uploadMedia">Upload Media</button>
    <button>Add Text</button>
    <button onclick="document.getElementById('exportPopup').style.display='block'">Export</button>
  </div>

  <div class="main-area">
    <div class="canvas-container">
      <div id="canvas">
        <!-- User inserted content will appear here -->
      </div>
    </div>
    <div class="sidebar">
      <h3>Properties</h3>
      <p>Selected element properties will appear here.</p>
    </div>
  </div>

  <div id="exportPopup" class="export-popup">
    <h3>Select Export Format</h3>
    <button onclick="exportCanvasToPNG()">Export PNG</button>
    <button onclick="exportCanvasToMP4()">Export MP4</button>
    <button onclick="alert('Exporting as GIF')">Export GIF</button>
    <button onclick="document.getElementById('exportPopup').style.display='none'">Cancel</button>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      document.querySelector('.toolbar button:nth-child(2)').addEventListener('click', () => {
        const canvas = document.getElementById('canvas');
        const textEl = document.createElement('div');
        textEl.contentEditable = true;
        textEl.textContent = 'Editable Text';
        textEl.style.position = 'absolute';
        textEl.style.top = '20px';
        textEl.style.left = '20px';
        textEl.style.color = 'white';
        textEl.style.fontSize = '18px';
        textEl.style.fontFamily = 'Segoe UI, sans-serif';
        textEl.style.padding = '4px';
        textEl.style.cursor = 'move';

        textEl.draggable = true;
        textEl.addEventListener('dragstart', ev => {
          ev.dataTransfer.setData('text/plain', null);
          ev.dataTransfer.setDragImage(new Image(), 0, 0);
          ev.target.classList.add('dragging');
        });
        textEl.addEventListener('dragend', ev => {
          ev.target.style.left = ev.pageX - canvas.offsetLeft + 'px';
          ev.target.style.top = ev.pageY - canvas.offsetTop + 'px';
          ev.target.classList.remove('dragging');
        });

        canvas.appendChild(textEl);
      });
      document.getElementById("uploadMedia").addEventListener("click", () => {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*,video/*,image/svg+xml";
        input.onchange = e => {
          const file = e.target.files[0];
          if (!file) return;
          const url = URL.createObjectURL(file);
          const canvas = document.getElementById("canvas");
          let element;

          if (file.type.startsWith("image/")) {
            element = document.createElement("img");
            element.src = url;
            element.style.maxWidth = "200px";
            element.style.maxHeight = "200px";
          } else if (file.type.startsWith("video/")) {
            element = document.createElement("video");
            element.src = url;
            element.controls = true;
            element.style.maxWidth = "300px";
            element.style.maxHeight = "200px";
          } else if (file.type === "image/svg+xml") {
            element = document.createElement("embed");
            element.src = url;
            element.type = "image/svg+xml";
            element.style.width = "200px";
            element.style.height = "200px";
          }

          if (element) {
            element.style.position = "absolute";
            element.style.top = "10px";
            element.style.left = "10px";
            element.draggable = true;
            element.addEventListener("dragstart", ev => {
              ev.dataTransfer.setData("text/plain", null);
              ev.dataTransfer.setDragImage(new Image(), 0, 0);
              ev.target.classList.add("dragging");
            });
            element.addEventListener("dragend", ev => {
              ev.target.style.left = ev.pageX - canvas.offsetLeft + "px";
              ev.target.style.top = ev.pageY - canvas.offsetTop + "px";
              ev.target.classList.remove("dragging");
            });
            canvas.appendChild(element);
          }
        };
        input.click();
      });
    });
  </script>

<script>
  function exportCanvasToPNG() {
    const canvasContainer = document.getElementById('canvas');

    // Clone canvas to remove unsupported elements
    const clone = canvasContainer.cloneNode(true);
    clone.querySelectorAll('video, embed').forEach(el => el.remove());

    // Place offscreen
    clone.style.position = 'absolute';
    clone.style.left = '-9999px';
    clone.style.top = '0';
    document.body.appendChild(clone);

    html2canvas(clone).then(canvas => {
      document.body.removeChild(clone);
      const link = document.createElement('a');
      link.download = 'exported.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    }).catch(err => {
      document.body.removeChild(clone);
      alert('‚ùå Export failed: ' + err.message);
    });
  }
</script>

<!-- Load html2canvas from CDN -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
<script>
  async function exportCanvasToMP4() {
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });
    await ffmpeg.load();

    const canvas = document.getElementById('canvas');
    const clone = canvas.cloneNode(true);
    clone.querySelectorAll('video, embed').forEach(el => el.remove());
    clone.style.position = 'absolute';
    clone.style.left = '-9999px';
    clone.style.top = '0';
    document.body.appendChild(clone);

    const frames = [];
    const captureFrames = async () => {
      for (let i = 0; i < 30; i++) { // 1 second at 30fps
        const canvasImage = await html2canvas(clone);
        const blob = await new Promise(resolve => canvasImage.toBlob(resolve, 'image/png'));
        frames.push({ name: `frame_${String(i).padStart(3, '0')}.png`, blob });
        await new Promise(r => setTimeout(r, 33)); // wait ~33ms between frames
      }
    };

    await captureFrames();
    document.body.removeChild(clone);

    for (const frame of frames) {
      ffmpeg.FS('writeFile', frame.name, await fetchFile(frame.blob));
    }

    await ffmpeg.run(
      '-framerate', '30',
      '-i', 'frame_%03d.png',
      '-c:v', 'libx264',
      '-pix_fmt', 'yuv420p',
      'output.mp4'
    );

    const data = ffmpeg.FS('readFile', 'output.mp4');
    const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(videoBlob);
    link.download = 'exported.mp4';
    link.click();
  }
</script>
</body>
</html>
